#!/bin/bash
set -e

echo "Applying blue deployment and service..."
kubectl apply -f blue_deployment.yaml
kubectl apply -f kubeservice.yaml

echo "Applying green deployment..."
kubectl apply -f green_deployment.yaml

echo
echo "Waiting for blue deployment to be ready..."
kubectl rollout status deployment/blue-deployment

echo
echo "Waiting for green deployment to be ready..."
kubectl rollout status deployment/green-deployment

echo
echo "Current blue and green pods:"
kubectl get pods -l app=messaging-app -o wide

echo
echo "Logs from green deployment pods:"
kubectl logs -l app=messaging-app,version=green --tail=50

